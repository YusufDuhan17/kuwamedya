{% extends "panel/_panel_layout.html" %}

{% block title %}Ders Yönetimi: {{ course.title }} | Kuwamedya{% endblock %}

{% block panel_content %}
<div class="d-flex justify-content-between align-items-center mb-4" data-aos="fade-down">
    <div>
        <h1 class="text-white fw-bold mb-2">Ders Yönetimi</h1>
        <p class="text-muted mb-0">{{ course.title }}</p>
    </div>
    <a href="{{ url_for('academy.manage_courses') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Kurslara Dön
    </a>
</div>

<!-- Ders Ekleme Formu -->
<div class="card bg-dark border-secondary shadow-lg mb-4" data-aos="fade-up">
    <div class="card-header bg-darker border-secondary">
        <h5 class="fw-bold mb-0"><i class="fas fa-plus-circle me-2"></i>Yeni Ders Ekle</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('academy.add_lesson', course_id=course.id) }}">
            {{ lesson_form.hidden_tag() }}
            <div class="row g-3">
                <div class="col-md-6">
                    {{ lesson_form.title.label(class_='form-label') }}
                    {{ lesson_form.title(class_='form-control bg-darker border-secondary text-white') }}
                </div>
                <div class="col-md-3">
                    {{ lesson_form.lesson_type.label(class_='form-label') }}
                    {{ lesson_form.lesson_type(class_='form-select bg-darker border-secondary text-white') }}
                </div>
                <div class="col-md-3">
                    {{ lesson_form.order.label(class_='form-label') }}
                    {{ lesson_form.order(class_='form-control bg-darker border-secondary text-white') }}
                </div>
                <div class="col-md-6">
                    {{ lesson_form.content.label(class_='form-label') }}
                    {{ lesson_form.content(class_='form-control bg-darker border-secondary text-white', rows=4) }}
                </div>
                <div class="col-md-6">
                    {{ lesson_form.video_url.label(class_='form-label') }}
                    {{ lesson_form.video_url(class_='form-control bg-darker border-secondary text-white', placeholder='YouTube video ID veya URL') }}
                    <small class="text-muted">Sadece Video tipi dersler için</small>
                </div>
                <div class="col-12">
                    {{ lesson_form.submit(class_='btn btn-primary') }}
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Quiz Ekleme Formu -->
<div class="card bg-dark border-secondary shadow-lg mb-4" data-aos="fade-up">
    <div class="card-header bg-darker border-secondary">
        <h5 class="fw-bold mb-0"><i class="fas fa-question-circle me-2"></i>Yeni Quiz Ekle</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('academy.add_quiz', lesson_id=course.lessons.first().id if course.lessons.first() else 0) }}">
            {{ quiz_form.hidden_tag() }}
            <div class="row g-3">
                <div class="col-md-6">
                    {{ quiz_form.title.label(class_='form-label') }}
                    {{ quiz_form.title(class_='form-control bg-darker border-secondary text-white') }}
                </div>
                <div class="col-12">
                    {{ quiz_form.questions_json.label(class_='form-label') }}
                    {{ quiz_form.questions_json(class_='form-control bg-darker border-secondary text-white', rows=10) }}
                    <small class="text-muted">JSON formatında sorular girin. Örnek: [{"question": "...", "options": [...], "correct_index": 0}]</small>
                </div>
                <div class="col-12">
                    {{ quiz_form.submit(class_='btn btn-success') }}
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Mevcut Dersler Listesi -->
<div class="card bg-dark border-secondary shadow-lg" data-aos="fade-up">
    <div class="card-header bg-darker border-secondary">
        <h5 class="fw-bold mb-0"><i class="fas fa-list-ul me-2"></i>Mevcut Dersler ({{ lessons|length }})</h5>
    </div>
    <div class="card-body p-0">
        {% if lessons %}
        <div class="table-responsive">
            <table class="table table-dark table-hover mb-0">
                <thead>
                    <tr>
                        <th class="px-4">Sıra</th>
                        <th class="px-4">Başlık</th>
                        <th class="px-4">Tip</th>
                        <th class="px-4">Eylemler</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lesson in lessons %}
                    <tr>
                        <td class="px-4">{{ lesson.order }}</td>
                        <td class="px-4">{{ lesson.title }}</td>
                        <td class="px-4">
                            <span class="badge bg-{% if lesson.lesson_type == 'Video' %}info{% elif lesson.lesson_type == 'Quiz' %}warning{% else %}primary{% endif %}">
                                {{ lesson.lesson_type }}
                            </span>
                        </td>
                        <td class="px-4">
                            <button class="btn btn-sm btn-outline-warning" onclick="editLesson({{ lesson.id }})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <form method="POST" action="{{ url_for('academy.delete_lesson', lesson_id=lesson.id) }}" class="d-inline" onsubmit="return confirm('Bu dersi silmek istediğinize emin misiniz?');">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center p-5">
            <i class="fas fa-book-open fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">Henüz ders eklenmemiş</h5>
            <p class="text-muted">Yukarıdaki form ile ilk dersinizi ekleyebilirsiniz.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function editLesson(lessonId) {
    // AJAX ile ders bilgilerini çek ve modal'ı doldur
    fetch(`{{ url_for('academy.edit_lesson', lesson_id=0) }}`.replace('0', lessonId))
        .then(response => response.json())
        .then(data => {
            // Modal'ı doldur ve göster
            console.log('Ders düzenle:', data);
            // Burada modal açma kodunu ekleyebilirsiniz
        });
}
</script>
{% endblock %}

